<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MuSoHu ROS2 Script Manager</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>MuSoHu ROS2 Script Manager</h1>
        <div id="scripts-container"></div>
        <div id="messages"></div>
    </div>

    <script>
        function updateScripts() {
            fetch('/api/scripts')
                .then(response => response.json())
                .then(scripts => {
                    const container = document.getElementById('scripts-container');
                    container.innerHTML = '';

                    Object.entries(scripts).forEach(([id, script]) => {
                        const div = document.createElement('div');
                        div.className = 'script-item';

                        const status = script.status === 'running' ? 'ðŸŸ¢' : 'âšª';

                        div.innerHTML = `
                            <h3>${status} ${script.description}</h3>
                            <p>Status: ${script.status}</p>
                            ${script.pid ? `<p>PID: ${script.pid}</p>` : ''}
                            <button onclick="controlScript('${id}', '${script.status === 'running' ? 'stop' : 'start'}')"
                                    class="${script.status === 'running' ? 'stop' : 'start'}">
                                ${script.status === 'running' ? 'Stop' : 'Start'}
                            </button>
                        `;

                        container.appendChild(div);
                    });
                })
                .catch(error => showMessage('Error: ' + error.message));
        }

        function controlScript(id, action) {
            fetch(`/api/scripts/${id}/${action}`, {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                showMessage(data.message);
                updateScripts();
            })
            .catch(error => showMessage('Error: ' + error.message));
        }

        function showMessage(message) {
            const messagesDiv = document.getElementById('messages');
            const messageElement = document.createElement('div');
            messageElement.className = 'message';
            messageElement.textContent = message;
            messagesDiv.appendChild(messageElement);

            setTimeout(() => {
                messageElement.remove();
            }, 5000);
        }

        // Update scripts status every 5 seconds
        updateScripts();
        setInterval(updateScripts, 5000);
    </script>
</body>
</html>

