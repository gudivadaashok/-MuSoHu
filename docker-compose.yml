# Docker Compose Configuration for MuSoHu
# Works on both macOS and Linux
# 
# For Linux with GPU/device support:
#   Set ENABLE_GPU=true and ENABLE_DEVICES=true before running
#   export ENABLE_GPU=true ENABLE_DEVICES=true
#   docker-compose up -d --build

services:
  ros2_helmet:
    build:
      context: .
      dockerfile: Dockerfile.zed
    container_name: ros2_helmet
    entrypoint: 
      - /bin/bash
      - -c
      - |
        if [ -f /etc/profile.d/ros2_entrypoint.sh ]; then
          source /etc/profile.d/ros2_entrypoint.sh
        fi
        exec /bin/bash
    stdin_open: true # docker run -i
    tty: true        # docker run -t
    hostname: robotixx
    privileged: true
    ipc: host
    runtime: nvidia
    volumes:
      - .:/workspace
      - /tmp/.X11-unix:/tmp/.X11-unix
      - /dev:/dev
    shm_size: 512m
    restart: unless-stopped
    environment:
      - DISPLAY=${DISPLAY}
      - NVIDIA_DRIVER_CAPABILITIES=all
      - ZED_CAMERA_MODEL=zed2i
    network_mode: "host"

  # web_app:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile.webapp
  #   container_name: musohu_webapp
  #   hostname: robotixx-webapp
  #   ports:
  #     - "5001:5001"
  #   volumes:
      # - .:/workspace
      # - /var/run/docker.sock:/var/run/docker.sock
  #     - ~/Desktop/Docker-Volumns/app_logs:/app/logs
  #     - ~/Desktop/Docker-Volumns/app_data:/app/data
  #     - ~/Desktop/Docker-Volumns/user_data:/app/users
  #   depends_on:
  #     - ros2_vnc
  #   restart: unless-stopped
  #   environment:
  #     - FLASK_ENV=development
  #     - FLASK_APP=ros2_script_manager/app.py
  #   networks:
  #     - ros2_network
  #   working_dir: /workspace

networks:
  ros2_network:
    driver: host

volumes:
  ros2_workspace:
    driver: local